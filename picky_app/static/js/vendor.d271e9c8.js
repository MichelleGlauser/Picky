var app=angular.module("windowshopper",["ngAnimate","ngTouch","ngCookies","ngSanitize","infinite-scroll","angular-redactor","ui.router","rt.encodeuri","config","angular-carousel","ct.ui.router.extras","underscore"]).config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c){function d(a){var b="";if(a&&a.state&&a.state.$$state){var c=a.state.$$state();if("product"===c.self.name)return c.self.url;for(;c.parent.self.name;)b=c.self.url+b,c=c.parent}return b}c.html5Mode(!0),b.rule(function(a,b){var c=b.url();return console.log("path",c),"/"===c[c.length-1]?c.replace(/\/$/,""):c.indexOf("/?")>0?c.replace("/?","?"):!1}),b.otherwise("404"),a.state("404",{url:"/404",templateUrl:"/static/views/404.93448274.html",controller:["Page",function(a){a.title="Page Not Found"}]}),b.when("/p/:brandSlug/:productSlug?v",["$match","$state","$location","$q","$timeout","$urlMatcherFactory","$previousState","$rootScope","$stateParams","stateRecorder",function(a,b,c,e,f,g,h,i){var j=h.get(),k=d(j),l=a.v?"/"+a.v:"/";if(j&&g.compile(k).exec(l))return!1;if(j&&"product"===j.state.name){if("product"===b.current.name)return!1;var m=d({state:b.current});if(g.compile(m).exec(l))return!1}for(var n=b.get(),o=0;o<n.length;o++){var p=d({state:b.get(n[o].name)}),q=g.compile(p).exec(l);if(q){var r=n[o].name,s=(g.compile(n[o].url).parameters(),e.defer()),t=i.$on("$stateChangeSuccess",function(a,b){s.resolve(b),t(),u()}),u=i.$on("$stateChangeError",function(a,b,c,d,e,f){s.reject(f),u(),t()});return void b.go(r,q).then(function(){return s.promise}).then(function(){b.go("product",a)},function(){a.v=null,b.go("root.browse").then(function(){b.go("product",a)})})}}return c.path()}]),a.state("product",{url:"/p/:brandSlug/:productSlug?v",views:{product:{template:"",controller:["$scope","$rootScope","product","Page","$state",function(a,b,c,d){b.productModalProduct=null,b.$broadcast("openProductModal",{product:c}),d.title=c.name}]}},resolve:{product:["$stateParams","WsApi","$rootScope",function(a,b,c){return c.productModalProduct?c.productModalProduct:b.getProduct(a.brandSlug,a.productSlug).then(function(a){return a.data})}]}}),a.state("root",{url:"","abstract":!0,sticky:!0,template:"<ui-view />"}),a.state("root.browse",{url:"/",views:{"":{templateUrl:"/static/views/browse.8905a49b.html",controller:["Page",function(a){a.title="Browse",a.description="Become a WindowShopper. Show off your style."}]},"top-right-btns@root.browse":{templateUrl:"/static/views/browse-top-right-btns.58299850.html"}}}),a.state("root.trendingTag",{url:"/tag/:tagName",views:{"":{templateUrl:"/static/views/trending-tags-single.c4f28f0e.html",resolve:{tag:["$stateParams","WsApi",function(a,b){return b.getTag(a.tagName).then(function(a){return a.data.tag})}]},controller:["$scope","WsApi","tag","Page",function(a,b,c,d){a.WsApi=b,a.getProductsWithTag=b.getProductsWithTag,a.tag=c,d.title="#"+c.name+" - Trending Tags"}]}}}),a.state("root.trendingTags",{url:"/trending-tags",views:{"":{templateUrl:"/static/views/trending-tags.1bd0f772.html",controller:["$scope","WsApi","Page",function(a,b,c){a.WsApi=b,a.getTrendingTags=b.getTrendingTags,c.title="Trending Tags"}]}}}),a.state("root.trendingArticles",{url:"/trending-posts",views:{"":{templateUrl:"/static/views/trending-articles.fb8d489c.html",controller:["Page",function(a){a.title="Trending Posts",a.description="The latest posts trending on WindowShopper."}]},"top-right-btns@root.trendingArticles":{templateUrl:"/static/views/trending-articles-top-right-btns.f4088df5.html"}}}),a.state("root.newArticle",{url:"/new-post",views:{"":{templateUrl:"/static/views/article-form.663d300b.html",controller:["$scope","Page",function(a,b){a.article={published:!1,featured:!1},b.title="New Post"}]},"top-right-btns@root.newArticle":{templateUrl:"/static/views/article-form-top-right-btns.4e28fa01.html"}}}),a.state("root.feed",{url:"/feed",data:{mustBeLoggedIn:!0},views:{"":{templateUrl:"/static/views/feed.d3361c0a.html",controller:["Page",function(a){a.title="Feed"}]}}}),a.state("settings",{url:"/settings",data:{mustBeLoggedIn:!0},views:{"":{templateUrl:"/static/views/settings.53ae0011.html",controller:["Page",function(a){a.title="Settings"}]}}}),a.state("unsubscribe",{url:"/unsubscribe?email&token&type",views:{"":{template:"",controller:["$stateParams","$state","$http",function(a,b,c){params={email:a.email,token:a.token,type:a.type},c.get("/api/user/unsubscribe",{params:params}).success(function(){b.go("root.browse"),new PNotify({type:"success",text:"You have been unsubscribed from "+params.type+" emails"})}).error(function(a){b.go("root.browse"),new PNotify({type:"error",text:"Error unsubscribing: "+(a.error||a)})})}]}}}),a.state("about",{url:"/about",views:{"":{templateUrl:"/static/views/about.c66bce99.html",controller:["Page",function(a){a.title="About"}]}}}),a.state("terms",{url:"/terms",views:{"":{templateUrl:"/static/views/terms.6449b4f7.html",controller:["Page",function(a){a.title="Terms of Service"}]}}}),a.state("privacy",{url:"/privacy",views:{"":{templateUrl:"/static/views/privacy.ba342c9b.html",controller:["Page",function(a){a.title="Privacy Policy"}]}}}),a.state("resetPassword",{url:"/reset-password?email&token",views:{"":{templateUrl:"/static/views/reset-password.d492637e.html",controller:["$scope","Page","tokenValidity","$stateParams","$state",function(a,b,c,d,e){return 200!=c.status?(e.go("root.browse"),void new PNotify({type:"error",text:"Reset password error: "+c.data.error||c.data})):(a.meta={email:d.email,token:d.token},void(b.title="Reset password"))}]}},resolve:{tokenValidity:["$stateParams","$http","ENV",function(a,b,c){var d={email:a.email,token:a.token};return b.get(c.apiEndpoint+"/auth/reset-password/check-token",{params:d}).then(function(a){return a},function(a){return a})}]}}),a.state("profileRedirect",{url:"/profile",data:{mustBeLoggedIn:!0},views:{"":{template:"",controller:["$state","WsApi",function(a,b){a.go("root.profile",{profileUsername:b.auth.currentUser.username})}]}}}),a.state("root.profile",{url:"/:profileUsername",views:{"":{templateUrl:"/static/views/profile.9e739813.html",controller:["$scope","$state","profile","Page",function(a,b,c,d){a.$state=b,a.profile=c,d.title=c.username}]},"profileTab@root.profile":{templateUrl:"/static/views/partials/profile-liked.1f094b2f.html"}},resolve:{profile:["$stateParams","WsApi",function(a,b){return b.getProfile(a.profileUsername).then(function(a){return a.data})}]}}).state("root.profile.tagged",{"abstract":!0,url:"/tags",views:{profileTab:{template:"<ui-view/>"}}}).state("root.profile.tagged.tags",{url:"",templateUrl:"/static/views/partials/profile-tags.243aafc2.html"}).state("root.profile.tagged.singleTag",{url:"/:tagName",templateUrl:"/static/views/partials/profile-single-tag.e68a5f53.html",resolve:{tag:["$stateParams","WsApi",function(a,b){return b.getTagByUser(a.profileUsername,a.tagName).then(function(a){return a.data.tag})}]},controller:["$scope","tag",function(a,b){a.tag=b,setTimeout(function(){$("html, body").animate({scrollTop:$(".single-tag-header").offset().top-20},300)},500)}]}).state("root.profile.following",{url:"/following",views:{profileTab:{templateUrl:"/static/views/partials/profile-following.3efa5c18.html"}}}).state("root.profile.followers",{url:"/followers",views:{profileTab:{templateUrl:"/static/views/partials/profile-followers.e7456f4e.html"}}}).state("root.profile.articles",{url:"/posts",views:{profileTab:{templateUrl:"/static/views/partials/profile-articles.7cb94f8c.html"}}}),a.state("followUser",{url:"/:username/follow",controller:["$stateParams","$state","$http",function(a,b,c){c.get("/api/user/follow/"+a.username).success(function(){new PNotify({type:"success",text:"You are now following "+a.username})}).error(function(a,b){401===b?$rootScope.$broadcast("showSignInModal"):new PNotify({type:"error",text:"Error: "+(a.error||a)})}),b.go("root.profile",{profileUsername:a.username})}]}),a.state("root.article",{url:"/:articleUsername/:articleSlug",views:{"":{templateUrl:"/static/views/article.4370db3d.html",controller:["$scope","article","Page",function(a,b,c){a.article=b,c.title=b.title}]},"top-right-btns@root.article":{templateUrl:"/static/views/article-top-right-btns.d764816d.html"}},resolve:{article:["$stateParams","WsApi",function(a,b){return b.getArticle(a.articleUsername,a.articleSlug).then(function(a){return a.data})}]}}),a.state("root.editArticle",{url:"/:articleUsername/:articleSlug/edit",views:{"":{templateUrl:"/static/views/article-form.663d300b.html",controller:["$scope","article","Page",function(a,b,c){a.article=b,c.title="Edit Post"}]},"top-right-btns@root.editArticle":{templateUrl:"/static/views/article-form-top-right-btns.4e28fa01.html"}},resolve:{article:["$stateParams","WsApi",function(a,b){return b.getArticleForEdit(a.articleUsername,a.articleSlug).then(function(a){return a.data})}]}})}]).run(["$rootScope","stateRecorder","$window","$state","$location","$timeout","WsApi","WsUi","Page",function(a,b,c,d,e,f,g,h,i){a.$state=d,a.$on("$stateChangeSuccess",function(a,b){console.log("toState",b),c.ga("send","pageview",{page:e.path()})}),a.$on("$stateChangeStart",function(c,e,f,h,j){b.previousWrappedState=d.$current,"product"===e.name&&h.name!==e.name&&(b.title=i.title,b.setPrev(h.name,j)),"product"===h.name&&"product"!==e.name&&(b.clearPrev(),a.$broadcast("closeProductModal")),e.data&&e.data.mustBeLoggedIn&&g.auth.isNotLoggedIn()&&(c.preventDefault(),g.auth.getCurrentUser().then(function(b){"Not authenticated"!==b?d.go(e.name,f,{notify:!1}).then(function(){a.$broadcast("$stateChangeSuccess",e,f,h,j)}):""===h.name?d.go("root.browse").then(function(){a.$broadcast("$stateChangeSuccess","root.browse",h,j),a.$broadcast("showSignInModal")}):a.$broadcast("showSignInModal")}))}),a.$on("$stateChangeError",function(){d.go("404")}),FastClick.attach(document.body)}]).factory("stateRecorder",["$state",function(a){var b="root.browse",c={};return{backToPreviousState:function(){null!=b&&a.go(b,c)},setPrev:function(a,d){b=a,c=d},clearPrev:function(){b=null,c=null},wrappedPreviousState:{}}}]).filter("reverse",function(){return function(a){return"undefined"!=typeof a?a.slice().reverse():void 0}}).filter("escape",function(){return window.escape}).filter("asDate",function(){return function(a){return new Date(a)}}),underscore=angular.module("underscore",[]);underscore.factory("_",function(){return window._}),angular.module("config",[]).constant("ENV",{name:"production",googleAnalyticsKey:"UA-39910395-1",apiEndpoint:"https://api.windowshopper.me"}),angular.module("windowshopper").controller("MainCtrl",["$scope","$http","WsApi","WsUi","ENV","$state","Page","$rootScope","Browse","$location",function(a,b,c,d,e,f,g,h,i,j){ga("create",e.googleAnalyticsKey,"windowshopper.me"),a.Page=g,a.navbar={show:{site:!1,filters:!1,history:!1}},a.toggleNavbar=function(b){a.navbar.inTransition=!0,a.navbar.show[b]=!a.navbar.show[b],$("html, body, .navbar").animate({scrollTop:0},200),setTimeout(function(){a.navbar.inTransition=!1},300)},a.WsUi=d,a.WsApi=c,a.executeKeydownAsClick=d.modalKeypressHandling.executeKeypressAsClick,h.$on("auth:loaded",function(){c.auth.isLoggedIn()?(a.currentUser=c.auth.currentUser,ga("set","&uid",c.auth.currentUser.id),i.filters.gender=c.auth.currentUser.gender):a.currentUser=null}),a.logout=function(){c.auth.logout().then(function(){f.go("root.browse"),new PNotify({type:"success",text:"You are now logged out"}),_trackEvent("User","Sign out","")},function(a){new PNotify({type:"error",text:"Error logging out: "+a})})},d.modal.cache(["signup","signin","forgot-password","welcome"]),h.$on("showSignInModal",function(){d.modal.show("signin")}),a.routeToProductModal=function(a){h.productModalProduct=a;var b,c={brandSlug:a.brand.slug,productSlug:a.slug};b=f.is("product")?j.search().v:j.path().substring(1),b&&(c.v=b),console.log(c,"from main.js"),f.go("product",c)}}]),angular.module("windowshopper").directive("enterToClose",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){c[0].setAttribute("tabindex","-1");var e=d.enterToClose;b.$watch(function(a){return a.navbar.show[e]},function(b){b&&a(function(){$(c).focus()},0)}),c.bind("keydown keypress",function(a){b.navbar.show[e]&&13==a.keyCode&&b.$apply(function(){b.toggleNavbar(e),a.stopPropagation()})})}}}]),angular.module("windowshopper").directive("userCard",["WsApi","WsUi",function(a,b){return{restrict:"E",scope:{user:"=for"},replace:!0,templateUrl:"/static/views/cards/user-card.12576960.html",link:function(c){c.WsApi=a,c.WsUi=b,c.follow=function(b){a.user.follow(b)},c.unfollow=function(b){a.user.unfollow(b)}}}}]).directive("productCard",["WsUi","$location","$state",function(a){return{restrict:"E",replace:!0,scope:{product:"=for"},templateUrl:"/static/views/cards/product-card.131027a0.html",link:function(b){b.WsUi=a,b.routeToProductModal=b.$parent.routeToProductModal}}}]).directive("articleCard",function(){return{restrict:"E",scope:{article:"=for"},replace:!0,templateUrl:"/static/views/cards/article-card.1463464a.html"}}).directive("tagCard",["$parse",function(a){return{restrict:"E",scope:!0,replace:!0,templateUrl:"/static/views/cards/tag-card.90cd2d6f.html",link:function(b,c,d){b.tag=a(d.for)(b),"user"==d.type?b.tagState="root.profile.tagged.singleTag":"global"==d.type&&(b.tagState="root.trendingTag"),b.tagStateParams={tagName:b.tag.name}}}}]).directive("navbar",function(){return{restrict:"E",replace:!0,templateUrl:"/static/views/navbar.a03e6d85.html"}}).directive("layoutBtns",function(){return{restrict:"E",replace:!0,templateUrl:"/static/views/layout-btns.f22e5bcd.html"}}).directive("clickToCloseMenu",function(){return{restrict:"A",link:function(a,b){$(document).on("mousedown touchstart",function(c){var d=($(b),$(c.target));return d.is($(".menu-pusher"))&&0==a.navbar.inTransition?(a.$apply(function(){a.navbar.show.site=!1,a.navbar.show.filters=!1,a.navbar.show.history=!1}),c.preventDefault(),!1):void 0})}}}).directive("closeMenuOnClick",function(){return{restrict:"A",link:function(a){$(".site-nav a").on("mouseup touchstart",function(){a.navbar.show.site=!1})}}}).filter("prettyDate",function(){return function(a){var b=new Date(a||""),c=((new Date).getTime()-b.getTime())/1e3,d=Math.floor(c/86400);if(!(isNaN(d)||0>d||d>=31))return 0==d&&(60>c&&"just now"||120>c&&"1 minute ago"||3600>c&&Math.floor(c/60)+" minutes ago"||7200>c&&"1 hour ago"||86400>c&&Math.floor(c/3600)+" hours ago")||1==d&&"Yesterday"||7>d&&d+" days ago"||31>d&&Math.ceil(d/7)+" weeks ago"}}).filter("reverse",function(){return function(a){return"undefined"!=typeof a?a.slice().reverse():void 0}}).filter("escape",function(){return window.escape}),angular.module("windowshopper").directive("items",["WsApi","WsUi","$state","Browse","$timeout","$rootScope",function(a,b,c,d,e){return{restrict:"E",templateUrl:"/static/views/items.a6eda14f.html",link:function(a){var b=50;$("#browse-wrapper").bind("touchmove",function(a){a.preventDefault()}),$("#browse-wrapper").on("touchstart mousedown",function(b){a.$apply(function(){a.touchStart=b.originalEvent.touches?b.originalEvent.touches[0].pageX:b.originalEvent.pageX})}).on("touchmove mousemove",function(c){a.touchStart&&0!=a.touchStart&&(c.preventDefault(),a.$broadcast("hideInstructions"),a.$apply(function(){if(a.dragging=!0,c.originalEvent.touches)var d=c.originalEvent.touches[0].pageX;else var d=c.originalEvent.pageX;var e=$($(".like")[0]),f=$($(".dislike")[0]),g=$($(".animate-partial")[0]);Math.abs(a.touchStart-d)<b?(e.removeClass("active"),f.removeClass("active"),g.removeClass("animate-like-partial"),g.removeClass("animate-dislike-partial")):d>a.touchStart?(e.removeClass("active").addClass("active"),f.removeClass("active"),g.removeClass("animate-like-partial").addClass("animate-like-partial"),g.removeClass("animate-dislike-partial")):(f.removeClass("active").addClass("active"),e.removeClass("active"),g.removeClass("animate-dislike-partial").addClass("animate-dislike-partial"),g.removeClass("animate-like-partial")),a.touchLast=d}))}),$("#browse-wrapper").on("touchend mouseup",function(c){a.$apply(function(a){return 0==a.touchLast?(a.touchStart=0,void($(c.target).closest(".item").length>0&&a.routeToProductModal(d.products.queue[0]))):(Math.abs(a.touchStart-a.touchLast)<b||(a.touchLast>a.touchStart?a.likeProduct():a.dislikeProduct()),a.touchStart=0,a.touchLast=0,void e(function(){a.dragging=!1},300))})})},controller:["$scope","$http","$state",function(a,b,c){var e=3,f=!1;a.appendProducts=function(){f||(f=!0,d.products.append().then(function(){f=!1}))},a.nextProduct=function(b){if(0!==d.products.queue.length){var c=d.products.queue.shift();b?d.products.addLiked(c):d.products.addDisliked(c),d.products.queue.length<e&&a.appendProducts()}},a.likeProduct=function(){_trackEvent("Product","Like",""),$($(".like")[0]).removeClass("active").addClass("active"),a.nextProduct(!0)},a.dislikeProduct=function(){$($(".animate-like")[0]).removeClass("animate-like").addClass("animate-dislike"),$($(".dislike")[0]).removeClass("active").addClass("active"),_trackEvent("Product","Dislike",""),a.nextProduct(!1)},Mousetrap.bind("enter",function(){a.$apply(function(){for(var b in a.navbar.show)if(a.navbar.show[b])return!0;return"false"===$("#the-modal").attr("aria-hidden")?!0:a.showInstructions?(a.hideInstructions(),!0):void a.routeToProductModal(d.products.queue[d.products.queue.length-1])})}),Mousetrap.bind(["left","down"],function(){a.$broadcast("hideInstructions"),a.$apply(function(){return a.showInstructions?(a.hideInstructions(),!0):c.is("product")?!0:void a.dislikeProduct()})}),Mousetrap.bind(["right","up"],function(){a.$broadcast("hideInstructions"),a.$apply(function(){return a.showInstructions?(a.hideInstructions(),!0):c.is("product")?!0:void a.likeProduct()})}),$("#ItemsListCtrl").focus(),a.touchStart=0,a.touchLast=0}]}}]).directive("itemInstructions",["WsApi","WsUi","$window","Browse","$timeout","$state","_",function(a,b,c,d,e,f,g){return{restrict:"E",scope:!0,templateUrl:"/static/views/item-instructions.2ca28344.html",controller:["$scope",function(b){$(document).on("hidden.bs.modal","#the-modal",function(c){-1!=c.currentTarget.outerHTML.indexOf("welcome")&&a.auth.isNotLoggedIn()&&(b.$apply(function(){b.showInstructionsPt1=!0}),_trackEvent("Browse instructions","show part 1",""))}),b.$watchCollection("[Browse.products.liked.length, Browse.products.disliked.length]",function(c,d){if(f.is("root.browse")){var h=g.reduce(d,function(a,b){return a+b},0),i=g.reduce(c,function(a,b){return a+b},0);1===i&&0===h&&a.auth.isNotLoggedIn()&&(e(function(){b.showInstructionsPt2=!0},300),_trackEvent("Browse instructions","show part 2",""))}}),b.hideInstructions=function(){b.showInstructionsPt1&&(b.showInstructionsPt1=!1,_trackEvent("Browse instructions","hide part 1","")),b.showInstructionsPt2&&(b.showInstructionsPt2=!1,_trackEvent("Browse instructions","hide part 2",""))},b.$on("hideInstructions",function(){b.hideInstructions()})}]}}]),angular.module("windowshopper").directive("filters",["WsApi","Browse",function(a,b){return{restrict:"E",templateUrl:"/static/views/filters.234c576a.html",controller:["$scope","$http","$rootScope",function(a,c){function d(a){return 13==a.keyCode||a.keyCode>=37&&a.keyCode<=40||9==a.keyCode||16==a.keyCode?!0:!1}a.Browse=b,a.showSale=!0,a.showPrice=!0;var e;a.setGender=function(a){b.filters.setGender(a),_trackEvent("Filter","Change","gender: "+a)},a.searchProducts=function(c){d(c)||(clearTimeout(e),e=setTimeout(function(){""!==b.filters.search&&_trackEvent("Filter","Change","search: "+a.search),b.products.replace()},1e3))},a.toggleColors=function(){return a.colors.length>0?void(a.colors=[]):void c.get("/api/colors").success(function(b){a.colors=b.colors})},a.changeColor=function(c){var d=_.reduce(a.colors,function(a,b){return b.id==c?b.name:a},"");_trackEvent("Filter","Change","color: "+d),b.filters.color=b.filters.color==c?"":c},$("#sale").slider().on("slide slideStop",function(c){a.$apply(function(){b.filters.sale=c.value})}).on("slideStop",function(){_trackEvent("Filter","Change","sale: "+b.filters.sale),b.products.replace()}),$("#priceRange").slider().on("slide slideStop",function(c){a.$apply(function(){c.value[1]<c.value[0]?(b.filters.priceMin=c.value[1],b.filters.priceMax=c.value[0]):(b.filters.priceMin=c.value[0],b.filters.priceMax=c.value[1])})}).on("slideStop",function(){_trackEvent("Filter","Change","min: "+b.filters.priceMin+" max: "+b.filters.priceMax),b.products.replace()}),a.$watch("Browse.filters.sale",function(a){$("#sale").slider("getValue")!=a&&$("#sale").slider("setValue",b.filters.sale)}),a.$watch("Browse.filters.priceMin",function(a){$("#priceRange").slider("getValue")[0]!=a&&$("#priceRange").slider("setValue",[b.filters.priceMin,b.filters.priceMax])}),a.$watch("Browse.filters.priceMax",function(a){$("#priceRange").slider("getValue")[1]!=a&&$("#priceRange").slider("setValue",[b.filters.priceMin,b.filters.priceMax])})}],link:function(){}}}]),angular.module("windowshopper").directive("modal",["WsUi",function(a){return{restrict:"E",scope:{},templateUrl:"/static/views/modal.876a1b1d.html",link:function(b){b.modal={source:"/static/views/modals/welcome.e085bbdc.html",errors:""},a.modal._set(b)},controller:["$scope","$http",function(a){a.show=function(b){a.modal.source=b,$("#the-modal").modal("show")},a.hide=function(){$("#the-modal").modal("hide")},a.setErrors=function(b){a.modal.errors=b}}]}}]),angular.module("windowshopper").controller("ProfileCtrl",["$scope","$http","WsApi","WsUi","$state",function(a,b,c,d){a.WsApi=c,a.WsUi=d,a.getLikedProducts=c.getLikedProducts,a.getTagsByUser=c.getTagsByUser,a.getProductsTaggedByUser=c.getProductsTaggedByUser,a.getFollowing=c.getFollowing,a.getFollowers=c.getFollowers,a.getArticles=c.getArticles,a.isMyProfile=function(){return c.auth.isLoggedIn()&&a.profile.username===a.currentUser.username},a.$on("dislikedProduct",function(b,c){a.$broadcast("autoqueryView.remove",c.product)})}]).directive("socialUserIcons",function(){return{restrict:"E",scope:!0,templateUrl:"/static/views/partials/profile-social-user-icons.84ac7417.html",controller:["$scope",function(a){a.showEditProfileIfEmpty=function(a,b){"undefined"!=typeof a&&a||($state.go("settings"),b.preventDefault())}}]}}),angular.module("windowshopper").directive("fileread",[function(){return{scope:{fileread:"="},link:function(a,b){b.bind("change",function(b){var c=new FileReader;c.onload=function(b){a.$apply(function(){a.fileread=b.target.result})},c.readAsDataURL(b.target.files[0])})}}}]).directive("remaining",function(){return{template:"{{remaining}} characters left",scope:{maxLen:"@max",model:"=ngModel"},link:function(a){a.$watch("model",function(b){if(void 0!==b){var c=parseInt(a.maxLen,10);if(null==b)return a.remaining=c;var d=c-b.length;0>d?a.model=b.substr(0,c):a.remaining=d}})}}}).controller("SettingsCtrl",["$scope","$http","ENV",function(a,b,c){a.settings={},a.saving=!1,a.getSettings=function(){b.get(c.apiEndpoint+"/user/settings").success(function(b){a.settings=b}).error(function(){})},a.saveSettings=function(){a.saving=!0,b.post(c.apiEndpoint+"/user/settings",a.settings).success(function(){$("body").scrollTop(0),new PNotify({type:"success",text:"Settings saved"}),a.saving=!1}).error(function(){$("body").scrollTop(0),new PNotify({type:"error",text:"Unable to save settings"}),a.saving=!1})},a.getSettings(),a.s3Upload=function(){$(".spinner").removeClass("hide");new S3Upload({file_dom_selector:"file",s3_sign_put_url:c.apiEndpoint+"/s3/sign",onProgress:function(){},onFinishS3Put:function(b){a.settings.profile_image_url=b,a.saveSettings(),$(".spinner").addClass("hide")},onError:function(a){$(".status").html("Upload error: "+a),$(".status").show(),$(".spinner").addClass("hide")}})}}]),angular.module("windowshopper").controller("FeedCtrl",["$scope","$http","WsApi",function(a,b,c){a.WsApi=c,a.getFeed=c.getFeed}]).directive("suggestedUsers",function(){return{restrict:"E",replace:!0,scope:!0,templateUrl:"/static/views/partials/suggested-users.b7f45478.html",controller:["$scope","$http","ENV","$state",function(a,b,c,d){a.suggested=[],a.getSuggested=function(){b.get(c.apiEndpoint+"/top_users").success(function(b){a.suggested=b}).error(function(){})},a.getSuggested(),a.refreshFeed=function(){d.go(d.current,{},{reload:!0})}}]}}),angular.module("windowshopper").controller("BrowseCtrl",["$scope","$http","WsApi","WsUi","Browse","$rootScope","$state","$timeout",function(a,b,c,d,e,f,g,h){a.Math=window.Math,a.Browse=e,h(function(){g.is("root.browse")&&a.showWelcomeModal()},400),a.showWelcomeModal=function(){f.hasSeenWelcomeModal||1==c.auth.hasLoaded&&c.auth.isNotLoggedIn()&&(d.modal.show("welcome"),f.hasSeenWelcomeModal=!0)},f.$on("showWelcomeModal",function(){h(function(){g.is("root.browse")&&a.showWelcomeModal()},400)}),a.$watch("Browse.products.liked",function(){!c.auth.isNotLoggedIn()||10!==e.products.liked.length&&30!==e.products.liked.length||d.modal.show("signup")})}]),angular.module("windowshopper").controller("ArticleCtrl",["$scope","$http","WsApi","WsUi","$state","ENV",function(a,b,c,d,e,f){a.getArticles=c.getArticles,a.getTrendingArticles=c.getTrendingArticles,a.WsApi=c,a.WsUi=d,a.twitterVia=function(a){a.user.twitter_url||"WindowShopperMe"},a.showArticleImage=function(a){if("img"===a.target.tagName.toLowerCase()){if("a"===a.target.parentNode.tagName.toLowerCase())return;_trackEvent("Article","Image full screen",a.target.src),article_url=[location.protocol,"//",location.host,location.pathname].join(""),d.imageDisplay.show(a.target.src,article_url)}},a.redactorOptions={buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","table","link","alignment","horizontalrule"],s3:f.apiEndpoint+"/s3/redactor-sign",minHeight:200,convertVideoLinks:!1,linkNofollow:!0,imageTabLink:!1,toolbarFixedBox:!0,observeImages:!1,linkSize:1e4},a.saveArticle=function(c){if(!a.article.title||!a.article.title.length>0)return new PNotify({type:"error",text:"Please write a title for your post"}),!1;if(!a.article.content||!a.article.content.length>0)return void new PNotify({type:"error",text:"Please fill out some content for your post"});if(c){if(!a.article.image||!a.article.image.length>0)return void new PNotify({type:"error",text:"A featured image is required before publishing"});a.article.published=!0}return a.saving=!0,b.post(f.apiEndpoint+"/article",a.article).then(function(b){a.saving=!1,a.article=b.data,new PNotify(c?{type:"success",text:"Post published!"}:{type:"success",text:"Post saved"})},function(b){a.saving=!1,new PNotify("Duplicate slug"==b.data.error?{type:"error",text:"You already have a post with this same title, please choose another."}:{type:"error",text:"Unable to save article"})})},a.publishArticle=function(){a.saveArticle(!0).then(function(){e.go("root.article",{articleUsername:a.article.user.username,articleSlug:a.article.slug})})},a.previewArticle=function(){a.saveArticle(!1).then(function(){e.go("root.article",{articleUsername:a.article.user.username,articleSlug:a.article.slug})})},a.canEditArticle=function(){return a.article.user.username===a.currentUser.username||c.auth.currentUser.is_admin},a.deleteArticle=function(c){angular.element(c.target).hasClass("confirm-delete")?b.post(f.apiEndpoint+"/article/"+a.article.user.username+"/"+a.article.slug+"/delete").then(function(){new PNotify({type:"success",text:"Post deleted"}),e.go("root.profile.articles",{profileUsername:a.article.user.username})}):angular.element(c.target).text("Really delete?").addClass("confirm-delete")},a.s3Upload=function(){$(".spinner").removeClass("hide");new S3Upload({file_dom_selector:"file",s3_sign_put_url:f.apiEndpoint+"/s3/sign",onProgress:function(){},onFinishS3Put:function(b){a.article.image=b,a.saveArticle(),$(".spinner").addClass("hide")},onError:function(a){$(".status").html("Upload error: "+a),$(".status").show(),$(".spinner").addClass("hide")}})}}]).filter("notArticle",function(){return function(a,b){if(a){for(var c=[],d=0;d<a.length;d++)a[d].slug!=b.slug&&c.push(a[d]);return c}}}).filter("notByUser",function(){return function(a,b){if(a){for(var c=[],d=0;d<a.length;d++)a[d].user.username!=b.username&&c.push(a[d]);return c}}}).directive("fbSdk",["$window",function(a){return{restrict:"E",template:'<div id="fb-root"></div>',link:function(){function b(){a.FB.XFBML.parse()}a.FB?b():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){a.FB.init({appId:0x6737990e9ee8,xfbml:!0,version:"v2.0"}),b()})}}}]).directive("twitterSdk",["$window",function(a){return{restrict:"E",link:function(){function b(){a.twttr.widgets.load()}a.twttr?b():$.getScript("//platform.twitter.com/widgets.js",function(){b()})}}}]).directive("pinterestSdk",["$window","$location",function(a){return{restrict:"E",link:function(){function b(){a.parsePins()}a.parsePins?b():!function(c){var d=c.getElementsByTagName("SCRIPT")[0],e=c.createElement("SCRIPT");e.type="text/javascript",e.async=!0,e.src="//assets.pinterest.com/js/pinit.js",e["data-pin-build"]="parsePins",e.onload=function(){a.parsePins?b():setTimeout(e.onload,100)},d.parentNode.insertBefore(e,d)}(a.document)}}}]),angular.module("windowshopper").directive("history",["$state","Browse",function(a,b){return{restrict:"E",scope:!0,templateUrl:"/static/views/history.85c74551.html",controller:["$scope","$http",function(c){c.history={cat:"liked",products:b.products.liked},c.changeHistoryCat=function(a){c.history.cat=a,c.refreshHistoryProducts(),_trackEvent("History","Change","category: "+a)},c.refreshHistoryProducts=function(){"liked"==c.history.cat?c.history.products=b.products.liked:"disliked"==c.history.cat&&(c.history.products=b.products.disliked)},c.routeToProductModal=function(b){a.go("product",{brandSlug:b.brand.slug,productSlug:b.slug})}}],link:function(){}}}]),angular.module("windowshopper").service("WsApi",["$http","$log","$q","$rootScope","ENV",function(a,b,c,d,e){function f(c,d,e){return b.info("WsApi.get",c,d),d||(d=""),e||(e=20),a.get(c+encodeURIComponent(d)+"?count="+e)}this.getTrendingTags=function(a,b){return f(e.apiEndpoint+"/tags/trending",a,b)},this.getTag=function(a){return f(e.apiEndpoint+"/tag/"+a)},this.getProductsWithTag=function(a,b,c){return f(e.apiEndpoint+"/tag/"+a+"/products",b,c)},this.submitTags=function(b,c,d){var f={tags:d},g=e.apiEndpoint+"/product/"+b+"/"+c+"/tags";return a.post(g,f)},this.getProductsTaggedByUser=function(a,b,c){var d=a.username,g=a.tagName;return f(e.apiEndpoint+"/user/"+encodeURIComponent(d)+"/tag/"+g+"/products",b,c)},this.getTagByUser=function(a,b){return f(e.apiEndpoint+"/user/"+encodeURIComponent(a)+"/tag/"+b)},this.getTagsByUser=function(a,b,c){return f(e.apiEndpoint+"/user/"+encodeURIComponent(a)+"/tags",b,c)},this.getProduct=function(a,b){return f(e.apiEndpoint+"/product/"+a+"/"+b)},this.getRelatedProducts=function(a,b,c){var d=a.brandSlug,g=a.productSlug;return f(e.apiEndpoint+"/product/"+d+"/"+g+"/related",b,c)},this.getProductTaggings=function(a,b,c){var d=a.brandSlug,g=a.productSlug;return f(e.apiEndpoint+"/product/"+d+"/"+g+"/tags",b,c)},this.getProfile=function(a){return f(e.apiEndpoint+"/user/profile/"+encodeURIComponent(a))},this.getLikedProducts=function(a,b,c){return f(e.apiEndpoint+"/user/"+encodeURIComponent(a)+"/liked/",b,c)},this.getFollowing=function(a,b,c){return f(e.apiEndpoint+"/user/"+encodeURIComponent(a)+"/following/",b,c)},this.getFollowers=function(a,b,c){return f(e.apiEndpoint+"/user/"+encodeURIComponent(a)+"/followers/",b,c)},this.getArticles=function(a,b,c){return f(e.apiEndpoint+"/user/"+encodeURIComponent(a)+"/articles/",b,c)},this.getFeed=function(a,b){return f(e.apiEndpoint+"/user/feed/",a,b)},this.getTrendingArticles=function(a,b){return f(e.apiEndpoint+"/trending-articles/",a,b)},this.getArticle=function(a,b){return f(e.apiEndpoint+"/article/"+a+"/"+b)},this.getArticleForEdit=function(a,b){return f(e.apiEndpoint+"/article/"+a+"/"+b+"/edit")},this.user={follow:function(b){a({method:"POST",url:e.apiEndpoint+"/user/"+b.username+"/follow"}),_trackEvent("User","Follow",""),b.userFollows=!0},unfollow:function(b){a({method:"POST",url:e.apiEndpoint+"/user/"+b.username+"/unfollow"}),_trackEvent("User","Unfollow",""),b.userFollows=!1},isCurrentUser:function(a){return a.username===g.currentUser.username}};var g=this.auth={_onLoad:function(){d.$broadcast("auth:loaded")},hasLoaded:!1,isAuthenticated:!1,currentUser:null,getCurrentUser:function(){return a.get(e.apiEndpoint+"/auth").then(function(a){return g.hasLoaded=!0,a.data.authenticated===!0?(g.isAuthenticated=!0,g.currentUser=a.data,g._onLoad(),g.currentUser):(g.isAuthenticated=!1,g.currentUser=null,g._onLoad(),"Not authenticated")
})},reload:function(){return g.getCurrentUser()},register:function(b){return a.post(e.apiEndpoint+"/auth/register",b).then(function(){return g.reload()})},login:function(b){return a.post(e.apiEndpoint+"/auth/login",b).then(function(){return g.reload()})},logout:function(){return a.get(e.apiEndpoint+"/auth/logout").then(function(){return g.reload()})},isLoggedIn:function(){return g.hasLoaded&&g.isAuthenticated},isNotLoggedIn:function(){return g.hasLoaded&&!g.isAuthenticated||!g.hasLoaded}};this.auth.reload()}]),angular.module("windowshopper").factory("WsUi",["$http","$templateCache",function(a,b){var c=null,d=null,e={imageDisplay:{_set:function(a){c=a},show:function(a,b){c.showImage(a,b)},hide:function(){c.hide()}},modal:{_getTemplateUrl:function(a){return"welcome"==a?"/static/views/modals/welcome.e085bbdc.html":"signin"==a?"/static/views/modals/signin.2d539b84.html":"signup"==a?"/static/views/modals/signup.a771c859.html":"forgot-password"==a?"/static/views/modals/forgot-password.5e2ebf69.html":void 0},_set:function(a){d=a||d},cache:function(c){angular.isArray(c)||(c=[c]),angular.forEach(c,function(c){a.get(e.modal._getTemplateUrl(c),{cache:b})})},show:function(a){return d?(e.modal.setErrors(""),d.show(e.modal._getTemplateUrl(a)),e.modal.setFocus(),void _trackEvent("Modal","Show "+a,"")):setTimeout(function(){e.modal.show(a)},300)},hide:function(){$("#the-modal").modal("hide")},setErrors:function(a){d.setErrors(a)},setFocus:function(){$("#the-modal").on("shown.bs.modal",function(){$("#the-modal input:first-of-type").focus()}),setTimeout(function(){$("#the-modal input:first-of-type").focus()},0)}}};return e.modalKeypressHandling={closeOnEnter:function(a){13==a.keyCode&&(e.modal.hide(),a.stopPropagation())},executeKeypressAsClick:function(a){13==a.keyCode&&a.stopPropagation()}},$(document).on("hide.bs.modal","#the-modal",function(){_trackEvent("Modal","Hide","")}),e}]),angular.module("windowshopper").service("Page",["$location",function(a){this.url=function(){return a.absUrl()},this.canonicalUrl=function(){return a.protocol()+a.host()+a.path()},this.fullTitle=function(){return this.title?this.title+" - WindowShopper":"WindowShopper"},this.imagePermalink=function(){return/^http/.test(this.image)?this.image:a.protocol()+a.host()+this.image}}]),angular.module("windowshopper").service("Browse",["$http","$location","WsApi","$q","$cookies","ENV",function(a,b,c,d,e,f){var g=this.products={queue:[],liked:[],disliked:[],meta:{loading:!0},get:function(){var b={offset:h.offset,limit:h.limit,search:h.search,color:h.color,sale:h.sale,priceMin:h.priceMin,priceMax:h.priceMax};return 0==b.sale&&delete b.sale,1e3==b.priceMax&&delete b.priceMax,b.gender="male"==h.gender?"men":"women",a.get(f.apiEndpoint+"/products",{params:b}).then(function(a){return h.offset=a.data.offset+a.data.products.length,a})},replace:function(){this.meta.loading=!0,h.offset=0,this.queue=[],this.get().then(function(a){g.meta.loading=!1,g.queue=a.data.products})},append:function(){return this.get().then(function(a){var b=a.data;for(i=0;i<b.products.length;i++)g.queue.push(b.products[i])})},addLiked:function(b){c.auth.isLoggedIn()&&a.post(f.apiEndpoint+"/user/add_liked",{productIds:[b.id]});for(var d=0;d<this.liked.length;d++)this.liked[d].id===b.id&&this.liked.splice(d,1);for(var e=0;e<this.disliked.length;e++)this.disliked[e].id===b.id&&this.disliked.splice(e,1);this.liked.push(b)},addDisliked:function(b){c.auth.isLoggedIn()&&a.post(f.apiEndpoint+"/user/add_disliked",{productIds:[b.id]});for(var d=0;d<this.liked.length;d++)this.liked[d].id===b.id&&this.liked.splice(d,1);for(var e=0;e<this.disliked.length;e++)this.disliked[e].id===b.id&&this.disliked.splice(e,1);this.disliked.push(b)}},h=this.filters={gender:"",search:"",sale:"",priceMin:0,priceMax:0,colors:[],offset:0,limit:20,reset:function(){h.search="",h.sale=0,h.priceMin=0,h.priceMax=800,h.colors=[],h.offset=0,g.replace()},defaultGender:function(){var a=b.absUrl();return a.match(/\?mens?$/)?h.saveGender("male"):a.match(/\?womens?$/)?h.saveGender("female"):"male"==e.gender?"male":"female"==e.gender?"female":"female"},setGender:function(a){("male"==a||"female"==a)&&a!=h.gender&&(h.gender=a,h.saveGender(a),g.replace())},saveGender:function(b){if(c.auth.isLoggedIn()){var d;d={gender:b},a.post(f.apiEndpoint+"/user/settings",d)}else e.gender=b;return b}};h.gender=h.defaultGender(),h.reset()}]),angular.module("windowshopper").directive("autoqueryView",["$rootScope","$window","$timeout",function(){return{restrict:"E",transclude:!0,template:'<div infinite-scroll="update()" ng-transclude></div>',scope:{getData:"&querySource",query:"@querySource",extraArg:"=",itemsPerQuery:"@",bindTo:"@",removeListener:"&onItemRemoved"},link:function(a){var b=a.$$nextSibling;a.queryName=a.query.split("(")[0];var c;b.reset=function(){c=null,b[a.bindTo]=a.view={data:{items:[],hasMore:!0},isUpdating:!1,hasMore:!0}},b.reset(),(a.update=function(){!a.view.isUpdating&&a.view.data.hasMore&&(console.info("autoqueryView","update"),a.view.isUpdating=!0,a.getData({extraArg:a.extraArg,cursor:c,count:a.itemsPerQuery}).then(function(b){c=b.data.nextCursor,a.view.data.hasMore=b.data.hasMore,a.view.data.items=a.view.data.items.concat(b.data.items)}).finally(function(){a.view.isUpdating=!1}))})(),b.$on("autoqueryView.remove",function(b,c){var d=a.view.data.items.indexOf(c);-1!=d&&a.view.data.items.splice(d,1),a.removeListener({item:c}),b.stopPropagation&&b.stopPropagation()}),b.$on("autoqueryView.reload",function(c,d){d==a.queryName&&(a.view.isUpdating||(b.reset(),a.update()))})}}}]).directive("autoqueryLoader",function(){return{require:"^autoqueryView",restrict:"C",scope:!0,transclude:!0,template:'<div ng-show="view.isUpdating" ng-transclude></div>'}}).directive("autoqueryDone",function(){return{require:"^autoqueryView",restrict:"C",scope:!0,transclude:!0,template:'<div ng-show="!view.data.hasMore" ng-transclude></div>'}}).directive("autoqueryEmpty",function(){return{require:"^autoqueryView",restrict:"C",scope:!0,transclude:!0,template:'<div ng-show="view.isUpdating == false && view.data.items.length == 0" ng-transclude></div>'}}),angular.module("windowshopper").directive("fullscreenProductDisplay",["WsUi","WsApi","$rootScope",function(a,b,c){return{restrict:"E",scope:{},templateUrl:"/static/views/fullscreen-product-display.html",link:function(d){d.showProduct=function(a){_trackEvent("Product","View",a.id),d.product=a,$("#fullscreen-image").removeClass("hidden"),Mousetrap.bind("esc",d.hide)},d.hide=function(){d.product={},$("#fullscreen-image").addClass("hidden"),Mousetrap.unbind("esc",d.hide)},d.open=function(a){_trackEvent("Product","Open",a.id),window.open(a.clickUrl)},d.like=function(e){if(e.id){if(b.auth.isNotLoggedIn())return void a.modal.show("signin");likedProducts=[e],_trackEvent("Product","Like from fullscreen",e.id),$.post("/add_liked",{likedProducts:JSON.stringify(likedProducts)}),d.hide(),new PNotify({type:"success",text:"Liked <em>"+e.name+"</em>",delay:3e3})}else c.$broadcast("likeDislikeProductFromFullscreen",{action:"like",product:e}),d.hide()},d.dislike=function(e){if(e.id){if(b.auth.isNotLoggedIn())return void a.modal.show("signin");dislikedProducts=[e],_trackEvent("Product","Dislike from fullscreen",e.id),$.post("/add_disliked",{dislikedProducts:JSON.stringify(dislikedProducts)}),d.hide(),new PNotify({type:"success",text:"Disliked <em>"+e.name+"</em>",delay:3e3}),c.$broadcast("dislikedProduct",{product:e})}else c.$broadcast("likeDislikeProductFromFullscreen",{action:"dislike",product:e}),d.hide()},a.productDisplay._set(d)}}}]),angular.module("windowshopper").directive("imageDisplay",["WsUi","WsApi","$rootScope",function(a){return{restrict:"E",scope:{},templateUrl:"/static/views/image-display.a47ba923.html",link:function(b){b.showImage=function(a,c){b.image={image_url:a,article_url:c},$("#image-display").removeClass("hidden"),Mousetrap.bind("esc",b.hide)},b.hide=function(){b.product={},$("#image-display").addClass("hidden"),Mousetrap.unbind("esc",b.hide)},a.imageDisplay._set(b)}}}]),angular.module("windowshopper").controller("ForgotPasswordModalCtrl",["$scope","WsUi","$http","ENV",function(a,b,c,d){a.WsUi=b,a.sendPasswordReset=function(){var e={username:a.user.username};c.post(d.apiEndpoint+"/auth/reset-password/send",e).then(function(){new PNotify({type:"success",text:"Please check your email for instructions to reset your password."}),b.modal.hide(),_trackEvent("User","Send reset password","")},function(a){b.modal.setErrors("Error: "+a.data.error)})},a.closeOnEnter=b.modalKeypressHandling.closeOnEnter,a.executeKeypressAsClick=b.modalKeypressHandling.executeKeypressAsClick}]),angular.module("windowshopper").controller("SigninModalCtrl",["$scope","$http","WsUi","$state","WsApi","Browse",function(a,b,c,d,e,f){a.WsUi=c,a.WsApi=e,a.user={},a.signIn=function(a){if(c.modal.setErrors(""),!a.username||!a.password)return void c.modal.setErrors("No username/email or password.");for(a.likedProductIds=[],i=0;i<f.products.liked.length;i++)a.likedProductIds.push(f.products.liked[i].id);for(a.dislikedProductIds=[],i=0;i<f.products.disliked.length;i++)a.dislikedProductIds.push(f.products.disliked[i].id);e.auth.login(a).then(function(){c.modal.hide(),d.go("root.browse"),new PNotify({type:"success",text:"Welcome, "+e.auth.currentUser.username+"!"}),_trackEvent("User","Sign in","")},function(a){c.modal.setErrors(a.data.error)})},a.closeOnEnter=c.modalKeypressHandling.closeOnEnter,a.executeKeypressAsClick=c.modalKeypressHandling.executeKeypressAsClick}]),angular.module("windowshopper").controller("WelcomeModalCtrl",["$rootScope","$scope","$http","WsUi","Browse",function(a,b,c,d,e){b.WsUi=d,b.closeOnEnter=d.modalKeypressHandling.closeOnEnter,b.executeKeypressAsClick=d.modalKeypressHandling.executeKeypressAsClick,b.welcomeModalSetGender=function(a){a!=e.filters.gender&&(e.filters.setGender(a),_trackEvent("Filter","Change","gender: "+a+" (welcome modal)")),d.modal.hide()}}]),angular.module("windowshopper").controller("SignupModalCtrl",["$scope","$http","WsUi","WsApi","$state","Browse",function(a,b,c,d,e,f){a.WsUi=c,a.WsApi=d,a.user={},a.register=function(b){function g(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}if(a.modal.errors="",!(b.email&&b.password&&b.username))return void c.modal.setErrors("No email, username and/or password.");if(!g(b.email))return void c.modal.setErrors("Not a valid email.");if(b.username.match(/\s/))return void c.modal.setErrors("Please choose a username without any spaces.");if(!/^\w+$/.test(b.username))return void c.modal.setErrors("Please choose a username that contains only letters, numbers, and underscores.");for(b.likedProductIds=[],i=0;i<f.products.liked.length;i++)b.likedProductIds.push(f.products.liked[i].id);for(b.dislikedProductIds=[],i=0;i<f.products.disliked.length;i++)b.dislikedProductIds.push(f.products.disliked[i].id);d.auth.register(b).then(function(){c.modal.hide(),e.go("root.profile",{profileUsername:d.auth.currentUser.username}),new PNotify({type:"success",text:"Welcome! You are now registered"}),_trackEvent("User","Sign up","")},function(a){c.modal.setErrors(a.data.error)})},a.executeKeypressAsClick=c.modalKeypressHandling.executeKeypressAsClick}]),angular.module("windowshopper").controller("ResetPasswordController",["$scope","$http","WsApi","$state","ENV",function(a,b,c,d,e){a.WsApi=c,a.submitPasswordReset=function(){if(a.resetPasswordForm.newPassword!=a.resetPasswordForm.newPasswordConfirm)return void(a.confirmError=!0);a.confirmError=!1;var f={email:a.meta.email,token:a.meta.token,password:a.resetPasswordForm.newPassword};b.post(e.apiEndpoint+"/auth/reset-password/reset",f).then(function(){d.go("root.browse"),c.auth.reload(),new PNotify({type:"success",text:"Password reset successfully. You are now logged in"}),_trackEvent("User","Reset password","")},function(a){new PNotify({type:"error",text:"Error resetting password: "+a.data.error||a.data})})}}]),angular.module("windowshopper").directive("productModal",["$state","WsUi","$timeout","stateRecorder","Page","$window","Browse","_",function(a,b,c,d,e,f,g,h){return{restrict:"E",templateUrl:"/static/views/modals/product-modal.671852d9.html",link:function(){},controller:["$scope","$rootScope","$state","WsUi","WsApi","$timeout","stateRecorder","Page","$window",function(a,b,c,d,e,f,i,j){a.WsApi=e,a.currentUser=e.auth.currentUser,a.getRelatedProducts=e.getRelatedProducts,a.getProductTaggings=e.getProductTaggings,a.carouselIndex=0,a.resetModal=function(){a.product=null,a.showTab={tags:!0,details:!1,related:!1},a.liked=null,a.carouselIndex=0},a.resetModal(),b.$on("openProductModal",function(b,c){a.resetModal(),a.product=c.product,f(function(){a.$broadcast("autoqueryView.reload","getProductTaggings"),a.$broadcast("autoqueryView.reload","getRelatedProducts")}),a.checkLikeStatus(),a.showProductModal()}),a.checkLikeStatus=function(){"liked"==a.product.liked_disliked_by_current_user?a.liked=!0:"disliked"==a.product.liked_disliked_by_current_user&&(a.liked=!1),h.contains(h.map(g.products.liked,function(a){return a.id}),a.product.id)?a.liked=!0:h.contains(h.map(g.products.disliked,function(a){return a.id}),a.product.id)&&(a.liked=!1)},a.showProductModal=function(){$("#pmodal").modal("show"),_trackEvent("Product modal","Open",a.product.id)},a.hideProductModal=function(){$("#pmodal").modal("hide")},b.$on("closeProductModal",function(){a.hideProductModal()}),$("#pmodal").on("hidden.bs.modal",function(){a.hideProductModalActions()}),a.hideProductModalActions=function(){_trackEvent("Product modal","Close",a.product.id),j.title=i.title,i.backToPreviousState(),b.$broadcast("showWelcomeModal"),a.resetModal()},a.openShareModal=function(){$("#product-share-modal").modal("show"),_trackEvent("Share modal","Open",a.currentUser?a.currentUser.id:"")},a.hideShareModal=function(){$("#product-share-modal").modal("hide")},$("#product-share-modal").on("hidden.bs.modal",function(){_trackEvent("Share modal","Close",a.currentUser?a.currentUser.id:""),a.hideProductModalActions()}),$(document).on({"show.bs.modal":function(){var a=$(".modal:visible").length;$(this).css("z-index",1041+10*a)},"hidden.bs.modal":function(){setTimeout(function(){$(".modal:visible").length>0&&($(document.body).addClass("modal-open"),$(".modal:visible").focus())},0)}},".modal"),$(document).on("click",".dropdown-toggle",function(){var a=$(this).parent().find(".dropdown-menu"),b=a.offset().top,c=a.offset().left,d=b+a.outerHeight(),e=$(window).width(),f=$(window).height();d>f&&$("#pmodal").animate({scrollTop:d+20-(f-$("#pmodal").scrollTop())},200),c+a.width()>=e?a.addClass("dropdown-menu-right"):a.removeClass("dropdown-menu-right")}),a.likeProduct=function(c,d,e){d?(a.liked=!0,g.products.addLiked(e),_trackEvent("Product modal","Like",e.id)):(a.liked=!1,g.products.addDisliked(e),_trackEvent("Product modal","Dislike",e.id),b.$broadcast("dislikedProduct",{product:e}))},a.toggleTab=function(b){_trackEvent("Product modal","Tab: "+b,a.product.id);for(var c in a.showTab)a.showTab[c]=c===b?!0:!1}}]}}]).directive("validateTags",function(){function a(a){for(var b=a.split(/\s+/),c=/^#[A-Z0-9]+$/i,d=0;d<b.length;d++)if(!c.test(b[d]))return!1;return!0}return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){var c=a(b);return e.$setValidity("validTags",c),b}),e.$formatters.push(function(b){var c=a(b);return e.$setValidity("validTags",c),b})}}}).controller("shareModalController",["$scope","$location",function(a,b){a.shareUrl=b.absUrl(),a.$on("$stateChangeSuccess",function(c,d){"product"===d.name&&(a.shareUrl=b.absUrl())})}]).controller("PmodalDetailsController",["$scope","$filter",function(a,b){a.product.provider_info&&a.product.provider_info.colors&&(a.filteredColorArray=b("filterColorArray")(a.product.provider_info.colors))}]).controller("PmodalTagsController",["WsApi","WsUi","$scope","$rootScope","$http","ENV",function(a,b,c,d,e,f){c.tagInput="#",c.$watch("tagInput",function(a){""===a&&(c.tagInput="#")}),d.$on("openProductModal",function(){c.tagInput="#"}),c.currentUserCanDeleteTagging=function(b){return a.auth.isNotLoggedIn()?!1:b.user.username==a.auth.currentUser.username||a.auth.currentUser.is_admin},c.deleteTagging=function(a,b,d){if(angular.element(a.target).hasClass("confirm-delete")){var g=$.param({username:d.username,brandSlug:c.product.brand.slug,productSlug:c.product.slug,tagName:b.tag.name});e({method:"POST",url:f.apiEndpoint+"/tagging/delete",data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){var b=angular.element(a.target).parent().parent().parent(),d=b.parent().parent(),e=b.parent().children().length;b.remove(),1===e&&d.remove(),_trackEvent("Tags","Delete",c.currentUser?c.currentUser.id:"")}).error(function(a){new PNotify({type:"error",text:"Error deleting: "+(a.error||a)})})}else angular.element(a.target).text("Really delete?").addClass("confirm-delete"),a.stopPropagation()},c.showErrors=!1,c.submitTag=function(){if(a.auth.isNotLoggedIn())return b.modal.show("signup");if(c.showErrors=!0,!c.taggingForm.tags.$error.validTags){var d=c.tagInput.split(/#|\s+#/);d.splice(0,1),a.submitTags(c.product.brand.slug,c.product.slug,d).success(function(){c.tagInput="#",c.showErrors=!1,_trackEvent("Tags","New",c.currentUser?c.currentUser.id:""),c.$broadcast("autoqueryView.reload","getProductTaggings")}).error(function(a){new PNotify({type:"error",text:"Error: "+(a.error||a)})})}}}]).directive("trackAndClick",["$window",function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.trackAndClick);b.bind("click",function(){_trackEvent(d.first_arg,d.second_arg,d.third_arg)})}}}]).filter("filterColorArray",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.image_url&&b.push(a)}),b}}).directive("moveCaret",function(){function a(a){if("selectionStart"in a)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}function b(a,b){if(a.createTextRange){var c=a.createTextRange();c.move("character",b),c.select()}else a.focus(),void 0!==a.selectionStart&&a.setSelectionRange(b,b)}return{restrict:"A",link:function(c,d){d.on("click",function(){c.$apply(function(){0==a(d[0])&&b(d[0],1)})})}}}).directive("restrict",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d){b.$watch(d.ngModel,function(c){c&&a(d.ngModel).assign(b,c.toLowerCase().replace(new RegExp(d.restrict,"g"),""))}),c.bind("keydown keypress",function(a){return 35===a.which?!1:void 0}),c.bind("keyup",function(c){32===c.which&&b.$apply(function(){var c=a(d.ngModel);c.assign(b,c(b).replace(/#\s/g,"#").replace(/\s$/g," #"))}),8===c.which&&b.$apply(function(){var c=a(d.ngModel);c.assign(b,c(b).replace(/\s#$/g,""))})})}}}]);